<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Travel Matchmaker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background: #f8f9fa;
    }
    .container {
      max-width: 800px;
      margin-top: 40px;
      padding: 30px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      margin-bottom: 30px;
      font-weight: 700;
      color: #007bff;
    }
    .matches {
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Travel Matchmaker</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST" novalidate>
      <div class="mb-3">
        <label class="form-label">Name</label>
        <input type="text" name="name" class="form-control" required value="{{ user.name if user else '' }}" />
      </div>

      <div class="mb-3 row">
        <div class="col">
          <label class="form-label">Age</label>
          <input type="number" name="age" class="form-control" min="1" max="120" required value="{{ user.age if user else '' }}" />
        </div>
        <div class="col">
          <label class="form-label">Gender</label>
          <input type="text" name="gender" class="form-control" value="{{ user.gender if user else '' }}" />
        </div>
      </div>

      <div class="mb-3 row">
        <div class="col">
          <label class="form-label">Location</label>
          <input type="text" name="location" class="form-control" value="{{ user.location if user else '' }}" />
        </div>
        <div class="col">
          <label class="form-label">Country</label>
          <input type="text" name="country" class="form-control" value="{{ user.country if user else '' }}" />
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label">Occupation</label>
        <input type="text" name="occupation" class="form-control" value="{{ user.occupation if user else '' }}" />
      </div>

      <div class="mb-3">
        <label class="form-label">Interests (comma separated)</label>
        <input type="text" name="interests" class="form-control" value="{{ user.interests|join(', ') if user else '' }}" />
      </div>

      <div class="mb-3">
        <label class="form-label">Languages (comma separated)</label>
        <input type="text" name="languages" class="form-control" value="{{ user.languages|join(', ') if user else '' }}" />
      </div>

      <div class="mb-3">
        <label class="form-label">Bio</label>
        <textarea name="bio" class="form-control" rows="3">{{ user.bio if user else '' }}</textarea>
      </div>

      <h5>Personality Traits (1-10)</h5>
      <div class="mb-3 row">
        <div class="col">
          <label class="form-label">Openness</label>
          <input type="number" name="openness" class="form-control" min="1" max="10" step="0.1" value="{{ (user.personality.openness*10)|round(1) if user else 5 }}" />
        </div>
        <div class="col">
          <label class="form-label">Extraversion</label>
          <input type="number" name="extraversion" class="form-control" min="1" max="10" step="0.1" value="{{ (user.personality.extraversion*10)|round(1) if user else 5 }}" />
        </div>
        <div class="col">
          <label class="form-label">Agreeableness</label>
          <input type="number" name="agreeableness" class="form-control" min="1" max="10" step="0.1" value="{{ (user.personality.agreeableness*10)|round(1) if user else 5 }}" />
        </div>
        <div class="col">
          <label class="form-label">Conscientiousness</label>
          <input type="number" name="conscientiousness" class="form-control" min="1" max="10" step="0.1" value="{{ (user.personality.conscientiousness*10)|round(1) if user else 5 }}" />
        </div>
      </div>

      <button type="submit" class="btn btn-primary">Find Matches</button>
    </form>

    {% if matches is not none %}
      <div class="matches">
        <h3 class="mt-5">Top Matches</h3>
        {% if matches %}
          <ul class="list-group">
            {% for match in matches %}
              <li class="list-group-item">
                <h5>{{ match.name }}</h5>
                <p><strong>Score:</strong> {{ (match.compatibility_score * 100) | round(2) }}%</p>
                <p>{{ match.explanation }}</p>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p>No matches found.</p>
        {% endif %}
      </div>
    {% endif %}
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
